
---

### "数据模型与决策" 课堂笔记 (小白完美版)

#### 课程目标

这堂课的目标是让你从0到1掌握“线性规划” (Linear Programming, LP)。我们将学习：

1. **LP是什么：** 它的三大核心组成部分。
    
2. **LP怎么用：** 如何把一个现实问题“翻译”成标准的LP模型。
    
3. **Excel怎么解：** 掌握“规划求解 (Solver)”工具的完整操作。
    
4. **结果怎么看：** 学会分析最优解，并读懂“敏感性报告” (Sensitivity Report)。
    

---

### Part 1: 线性规划 (LP) 的核心构成 (Cht-3)

老师首先带我们回顾了LP的基础。任何LP问题，都是在**有限的资源下**，追求一个**最优的目标**。

它由三个核心部分构成：

1. **决策变量 (Decision Variables):** 1
    
    - **定义：** 你需要“决定”的数字。
        
    - _例子：_ 我们要生产多少A产品？多少B产品？
        
2. **目标函数 (Objective Function):** 22
    
    - **定义：** 你要“最大化”或“最小化”的那个公式。
        
    - _例子：_ 最大化“总利润” 3333 或最小化“总成本”。
        
3. **约束条件 (Constraints):** 44
    
    - **定义：** 你在做决策时“必须遵守”的限制。
        
    - _例子：_ 你的组装时间不能超过10000小时 5555、你的A产品产量不能超过市场需求600个 6666。
        

核心原理：最优解一定在“顶点”

老师在课堂上强调，所有约束条件在图上会围成一个可行域 (Feasible Region) 77777777。而我们要找的最优解（比如利润最高的点），一定会出现在这个区域的某个顶点（Corner Point）上 8888。Excel的“单纯形法 (Simplex LP)”就是一种在这些顶点上高效搜索的数学方法。

---

### Part 2: 实战例题 1 - 产品组合 (Cht-3 & 例题1)

这是我们今天接触的第一个核心模型，也是理解敏感性分析的基础。

#### 1. 问题描述

一家公司生产两种电脑：Basic (A产品) 和 XP (B产品)。

- **利润：** Basic赚 80元/台，XP赚 129元/台 99。
    
- **资源约束：**
    
    - 组装时间：Basic需5小时，XP需6小时。总共可用 10,000 小时 10101010。
        
    - 测试时间：Basic需1小时，XP需2小时。总共可用 3,000 小时 11111111。
        
- **市场约束：** Basic最多卖 600 台，XP最多卖 1200 台 12121212。
    
- **目标：** 如何安排生产，使**总利润最大化**？ 1313
    

#### 2. 标准 LP 模型 (必会)

我们来把问题“翻译”成数学语言：

- **决策变量:**
    
    - $x_1$ = 生产 Basic (A产品) 的数量 14141414
        
    - $x_2$ = 生产 XP (B产品) 的数量 15151515
        
- **目标函数 (最大化总利润):**
    
    - `Maximize Z = 80 * x1 + 129 * x2` 16161616
        
- **约束条件:**
    
    - `5 * x1 + 6 * x2 <= 10000` (组装时间约束) 17171717
        
    - `1 * x1 + 2 * x2 <= 3000` (测试时间约束) 18181818
        
    - `x1 <= 600` (Basic 市场需求) 19191919
        
    - `x2 <= 1200` (XP 市场需求) 20202020
        
    - `x1, x2 >= 0` (产量不能为负) 21212121
        

#### 3. Excel 建模步骤 (小白版)

**A. 布局与命名 (老师强调的重点)**

1. **数据布局：** (参考 `Model.csv` 文件)
    
    - 将所有“输入” (如利润80, 129；工时5, 6等) 放在一个区域，标为蓝色。
        
    - 将“决策变量” (即 $x_1, x_2$ 的产量) 放在单元格 `B16:C16`，标为红色/黄色，**初始值设为0**。
        
    - 将“约束计算”和“目标函数”放在下面。
        
2. **定义名称 (重要技巧):** 22
    
    - 选中 `B16:C16`，在左上角的“名称框”中输入 `Number_to_produce` (生产数量) 并回车 23232323。
        
    - 这样做的好处是，写公式时不再需要用 `B16:C16`，而是可以直接用有意义的英文名 `Number_to_produce`，公式更易读 24242424。
        

B. 核心公式 (SUMPRODUCT)

`SUMPRODUCT` (乘积求和) 是LP建模的灵魂！25252525

1. **计算“组装已用工时” (B21):**
    
    - `=SUMPRODUCT(B8:C8, Number_to_produce)` 262626
        
    - _(它会计算: `B8*B16 + C8*C16`，即 5_$x_1$ + 6*$x_2$)*
        
2. **计算“测试已用工时” (B22):**
    
    - `=SUMPRODUCT(B9:C9, Number_to_produce)` 27
        
    - _(它会计算: `B9*B16 + C9*C16`，即 1_$x_1$ + 2*$x_2$)*
        
3. **计算“总利润” (D25 - 我们的目标):**
    
    - `=SUMPRODUCT(B12:C12, Number_to_produce)` 28282828
        
    - _(它会计算: `B12*B16 + C12*C16`，即 80_$x_1$ + 129*$x_2$)*
        

#### 4. Solver 参数设置 (文字版)

(根据你的 `例题1.md` 截图)

1. 打开 "数据" -> "规划求解 (Solver)" 29292929。
    
2. **设置目标 (Set Objective):** `$D$25` (即我们的总利润单元格) 303030。
    
3. **至 (To):** 选择“最大值 (Max)” 31。
    
4. **通过更改可变单元格 (By Changing Variable Cells):**
    
    - `$B$16:$C$16` (即我们命名的 `Number_to_produce`) 323232。
        
5. **约束 (Subject to the Constraints):** 33
    
    - `$B$16:$C$16 <= $B$18:$C$18` (产量 <= 市场需求上限)
        
    - `$B$16:$C$16 >= 0` (产量 >= 0，_虽然下面有非负选项，但明确写出是好习惯_)
        
    - `$B$21:$B$22 <= $D$21:$D$22` (已用工时 <= 可用工时) 34
        
6. 勾选 **“使无约束变量为非负数” (Make Unconstrained Variables Non-Negative)**。
    
7. **选择求解方法 (Solving Method):**
    
    - 选择 **“Simplex LP (单纯形线性规划)”** 35。
        
8. 点击“求解”，当出现“已找到解”时，在右侧框中选择 **“敏感性 (Sensitivity)”** 报告 36，然后点击“确定”。
    

#### 5. 如何分析结果 (模板)

**A. 最优解 (看 Model.csv)**

- **最优决策：** `Number_to_produce` (B16:C16) 变为 Basic (A) = **560** 台，XP (B) = **1200** 台。
    
- **最优目标：** `Total_profit` (D25) 变为 **$199,600**。
    
- **资源使用情况：**
    
    - 组装时间：使用了 `5*560 + 6*1200 = 10000` 小时。**(已用尽)**
        
    - 测试时间：使用了 `1*560 + 2*1200 = 2960` 小时。**(剩余 40 小时)**
        

B. 敏感性报告分析 (看 敏感性报告 1.csv)

这是LP的精髓！它告诉你如果参数变化，会发生什么。

**1. "Constraints" (约束) 表格：**

- **影子价格 (Shadow Price / 阴影价格):** 3737
    
    - **定义：** 当该项约束（资源）**增加1个单位**时，你的目标（总利润）能**增加多少** 38383838。
        
    - **分析 (组装时间):**
        
        - `assembling` (组装) 的影子价格是 **16** 39393939。
            
        - **结论：** 组装时间是**瓶颈资源** (Binding Constraint)。你每多获得1小时组装时间，总利润就能**增加16元**！40404040 如果要花钱买工时，只要价格低于16元/小时，就是赚的。
            
    - **分析 (测试时间):**
        
        - `testing` (测试) 的影子价格是 **0** 4141。
            
        - **结论：** 测试时间是**非瓶颈资源** (Non-Binding)。因为我们本来就还剩40小时没用完，所以再给你更多测试时间，对总利润也**没有任何帮助** (增加0元) 4242。
            
- **允许的增量/减少 (Allowable Increase / Decrease):** 43434343
    
    - **定义：** 告诉你“影子价格”在多大范围内有效。
        
    - **分析 (组装时间):**
        
        - 允许增量 200，允许减少 2800 4444。
            
        - **结论：** "1小时=16元" 的结论，只在你把总组装时间从 `(10000 - 2800) = 7200` 小时增加到 `(10000 + 200) = 10200` 小时这个区间内有效 45454545。如果超过10200小时，瓶颈会转移 (比如转移到测试时间上)，影子价格就会变了。
            

---

### Part 3: 实战例题 2 - 员工排班 (Cht-4 & 例题2)

这是LP在“人力资源”领域的经典应用，重点在于**决策变量的巧妙定义**。

#### 1. 问题描述

(基于 cht-04 例题2整数规划实战.pdf 和录音)

北京环球影城需要安排员工，每名员工每周连续工作5天，休息2天 46464646。

- **每日需求：** 影城周一到周日所需的**最少**员工人数分别为 (17, 13, 15, 19, 14, 16, 11) 47474747。
    
- **目标：** 雇佣**最少的总员工数**，同时满足每天的人数需求 48484848。
    

#### 2. 标准 LP 模型 (必会)

**重点：如何定义决策变量？**

- (错误定义)：$y_j$ = 周 $j$ 上班的人数。 (你无法体现“连上5天”的约束)
    
- (正确定义)：$x_j$ = **在周 $j$ 开始第一天工作的人数** (j=1..7, 即周一..周日) 49494949。
    
- **决策变量:**
    
    - $x_1, x_2, ..., x_7$ (分别代表周一、周二...周日开始上班的人数)
        
- **目标函数 (最小化总人数):**
    
    - `Minimize Z = x1 + x2 + x3 + x4 + x5 + x6 + x7` 505050
        
- **约束条件 (环绕式):**
    
    - _周一上班的人 = (周一)开始的 + (周日)开始的 + (周六) + (周五) + (周四)开始的_
        
    - `x1 + x4 + x5 + x6 + x7 >= 17` (周一需求) 5151515151
        
    - `x1 + x2 + x5 + x6 + x7 >= 13` (周二需求) 525252
        
    - `x1 + x2 + x3 + x6 + x7 >= 15` (周三需求) 535353
        
    - `x1 + x2 + x3 + x4 + x7 >= 19` (周四需求) 545454
        
    - `x1 + x2 + x3 + x4 + x5 >= 14` (周五需求) 555555
        
    - `x2 + x3 + x4 + x5 + x6 >= 16` (周六需求) 565656
        
    - `x3 + x4 + x5 + x6 + x7 >= 11` (周日需求) 575757
        
    - `xj >= 0` 且 `xj` **必须是整数 (Integer)** 5858585858585858
        

#### 3. Excel 建模步骤

(参考 `Cht4-Employee Scheduling...Model.csv`)

1. **决策变量 (B4:H4):** `Employees_starting` (周一到周日开始工作的人数)。
    
2. **核心公式 (B23:H23 - 每日实际上班人数):**
    
    - `B23` (周一实际): `=SUM(B4, D4:G4)` (注意Excel公式的巧妙，周四到周日开始的，周一都在岗)
        
    - `C23` (周二实际): `=SUM(B4:C4, E4:H4)`
        
    - _(以此类推...)_
        
    - `H23` (周日实际): `=SUM(D4:H4)`
        
3. **目标 (B28 - 总员工数):**
    
    - `=SUM(B4:H4)` 59
        

#### 4. Solver 参数设置 (文字版)

(根据你的 `例题2.md` 截图 - 基础模型)

1. **设置目标 (Set Objective):** `$B$28` (Total_Employees) 60。
    
2. **至 (To):** “最小值 (Min)”。
    
3. **通过更改可变单元格 (By Changing Variable Cells):**
    
    - `$B$4:$H$4` (Employees_starting) 61。
        
4. **约束 (Subject to the Constraints):**
    
    - `$B$4:$H$4 = integer` (整数约束) 6262。
        
    - `$B$23:$H$23 >= $B$25:$H$25` (每日实际人数 >= 每日需求) 63636363。
        
5. **选择求解方法 (Solving Method):** “Simplex LP”。
    

- **最优解 (看 `...求解后.csv`):** 总员工数 `B28` = **23** 人。
    

---

### Part 4: 线性规划的扩展 - 处理非线性 (Cht-4)

老师接着讲了，如果我们遇到**非线性 (Non-linear)** 约束怎么办？LP要求所有公式都是线性的，但我们可以通过数学转换，把一些非线性问题“变”成线性的。

扩展问题：排班 + 50% 约束 6464

在例题2的基础上，增加一个新约束：“周一开始工作的人数 ($x_1$) **不低于总人数 (Z) 的 50%**” 65。

#### 1. 为什么是非线性的？

- 这个约束是 `$x_1 / Z >= 0.5$`，或者 `$x_1 >= 0.5 * Z$` 66666666。
    
- $Z$ 本身是决策变量的和 ($x_1 + ... + x_7$) 6767。
    
- 所以公式是 `$x_1 >= 0.5 * (x_1 + ... + x_7)$`。
    
- **决策变量乘以决策变量**（或除以），就是非线性的 68686868。
    

#### 2. 线性化 (Linearization) 转换

老师在课堂上演示了如何用代数移项，把它变成线性的 69696969：

1. `x1 >= 0.5*x1 + 0.5*x2 + 0.5*x3 + 0.5*x4 + 0.5*x5 + 0.5*x6 + 0.5*x7`
    
2. `(1 - 0.5)*x1 - 0.5*x2 - ... - 0.5*x7 >= 0`
    
3. **`0.5*x1 - 0.5*x2 - 0.5*x3 - 0.5*x4 - 0.5*x5 - 0.5*x6 - 0.5*x7 >= 0`**
    

- 这个新公式是完全线性的！
    

#### 3. Excel 与 Solver 设置

(参考 `Cht4-...50%...Model.csv` 和 `例题2.md` 截图)

1. **Excel 添加计算：**
    
    - 在 B30 单元格输入“左侧”公式：
        
        =0.5*B4 - 0.5*SUM(C4:H4)
        
    - 在 `B32` 单元格输入“右侧”数字：`0`
        
2. **Solver 增加约束：**
    
    - 在原例题2的Solver参数中，**增加**一条约束：
        
    - `$B$30 >= $B$32` 70
        

- **最优解 (看 `...50%...csv`):** 总员工数 `B28` 变为了 **28** 人。 (结论：为了满足这个新约束，我们必须多雇佣5个人)。
    

---

### Part 5: 实战例题 3 - 数据包络分析 (DEA) (Cht-4 & 例题3)

这是今天最难、也最强大的模型。它用来评估**相对效率**。

#### 1. 问题描述

(基于 Cht-4 slides 71717171和录音 72)

我们要横向比较 3 家医院 (DMU 1, 2, 3) 的“效率”。

- **效率 = 加权产出 / 加权投入** 73
    
- **投入 (Inputs):** 2种。$I_1$ = 床位数, $I_2$ = 劳动工时 (千小时) 74。
    
- **产出 (Outputs):** 3种。$O_1, O_2, O_3$ = 3个年龄段的病患天数 75。
    
- **挑战：** 投入和产出单位都不同，无法直接比较。
    

#### 2. 核心原理 (DEA)

DEA的思路是：**“给我一次机会，让我用对自己最有利的权重来计算效率，看看我最高能得多少分？”** 767676

- 我们**为每一家医院（DMU）都单独求解一次LP**。
    
- **目标：** 最大化“当前这家医院”的效率得分 77。
    
- **核心约束：**
    
    1. （为了方便计算）我们固定“当前医院”的**加权投入 = 1** 78787878。
        
    2. （公平性）在“当前医院”自定义的这套权重下，**所有医院**（包括它自己）的**效率得分都必须 <= 1** 79797979。
        
- **结果判断：**
    
    - 如果最优解 = 1，说明这家医院是**相对有效的 (Efficient)** 808080。
        
    - 如果最优解 < 1 (比如 0.77)，说明无论它怎么调整权重，都无法成为标杆，它是**相对无效的 (Inefficient)** 818181。
        

#### 3. 标准 LP 模型 (以为医院1为例)

- **决策变量:**
    
    - $u_1, u_2$ (两种投入的权重) 82
        
    - $v_1, v_2, v_3$ (三种产出的权重) 83
        
- **目标函数 (最大化医院1的效率):**
    
    - _(因为医院1的加权投入被固定为1，所以效率=加权产出)_
        
    - `Maximize Z = v1 * (医院1产出1) + v2 * (医院1产出2) + v3 * (医院1产出3)` 84848484
        
- **约束条件:**
    
    - `u1 * (医院1投入1) + u2 * (医院1投入2) = 1` (医院1的加权投入=1) 85858585
        
    - _(所有医院效率 <= 1，即 加权产出 <= 加权投入)_
        
    - `[v1*O(1,1)+..] - [u1*I(1,1)+..] <= 0` (医院1效率 $\le 1$) 86868686
        
    - `[v1*O(2,1)+..] - [u1*I(2,1)+..] <= 0` (医院2效率 $\le 1$) 87878787
        
    - `[v1*O(3,1)+..] - [u1*I(3,1)+..] <= 0` (医院3效率 $\le 1$) 88888888
        
    - `u_i, v_j >= 0` (权重非负) 89898989
        

#### 4. Excel 建模步骤

(参考 `Hospital DEA...Model.csv`)

1. **决策变量 (权重):**
    
    - `B25:C25` (Input_Weights) -> $u_1, u_2$
        
    - `F25:H25` (Output_Weights) -> $v_1, v_2, v_3$
        
2. **计算所有医院的加权产出 (B33:B35):**
    
    - `B33` (医院1加权产出): `=SUMPRODUCT($F$25:$H$25, F6:H6)` (权重需$锁定)
        
    - `B34` (医院2加权产出): `=SUMPRODUCT($F$25:$H$25, F7:H7)`
        
    - `B35` (医院3加权产出): `=SUMPRODUCT($F$25:$H$25, F8:H8)`
        
3. **计算所有医院的加权投入 (D33:D35):**
    
    - `D33` (医院1加权投入): `=SUMPRODUCT($B$25:$C$25, B6:C6)` (权重需$锁定)
        
    - `D34` (医院2加权投入): `=SUMPRODUCT($B$25:$C$25, B7:C7)`
        
    - `D35` (医院3加权投入): `=SUMPRODUCT($B$25:$C$25, B8:C8)`
        
4. **计算目标 (B30 - 医院1的效率):**
    
    - `=B33` (因为我们是为医院1求解)
        
5. **计算约束 (B29 - 医院1的加权投入):**
    
    - `=D33`
        

#### 5. Solver 参数设置 (文字版)

(根据你的 `例题3.md` 截图 - 求解医院1)

1. **设置目标 (Set Objective):** `$B$30` (医院1的效率)。
    
2. **至 (To):** “最大值 (Max)”。
    
3. **通过更改可变单元格 (By Changing Variable Cells):**
    
    - `$B$25:$C$25, $F$25:$H$25` (所有权重) 90。
        
4. **约束 (Subject to the Constraints):**
    
    - `$B$29 = 1` (医院1的加权投入 = 1) 91。
        
    - `$B$33:$B$35 <= $D$33:$D$35` (所有医院的 加权产出 <= 加权投入) 92。
        
5. **选择求解方法 (Solving Method):** “Simplex LP”。
    

- **如何分析结果 (看录音):**
    
    - **步骤1：** 保持 Solver 不变，只把 `B30` 里的公式改成 `=B33`，求解。得到医院1的效率 = 1 93。
        
    - **步骤2：** 保持 Solver 不变，只把 `B30` 里的公式改成 `=B34`，求解。得到医院2的效率 (比如 0.77)。
        
    - **步骤3：** 保持 Solver 不变，只把 `B30` 里的公式改成 `=B35`，求解。得到医院3的效率 = 1 94。
        
    - **最终结论：** 医院1和医院3是相对有效的，医院2是相对无效的 95。
        

---

### Part 6: 课程总结 (Cht-4)

我们今天还接触了其他强大的LP模型，它们都遵循相同的逻辑：

- **放射治疗 (Radiation Therapy):** 96969696一个超大规模的LP问题（几万个变量），目标是最小化对健康器官的伤害，最大化对肿瘤的辐射 97979797。
    
- **万能的“线性化”：** 你的问题看起来是非线性的（比如 `Min Max` 98或比例约束 9999），但通常都可以通过聪明的数学变换，转换成可以用“Simplex LP”求解的线性问题 100100100100。
    

**今日核心：** 线性规划 (LP) 是一种极其强大的决策工具。掌握**“定义变量、设置目标、写出约束”**这三步，并熟练使用 **`SUMPRODUCT`** 和 **Solver**，你就可以解决商业中非常复杂的优化问题。